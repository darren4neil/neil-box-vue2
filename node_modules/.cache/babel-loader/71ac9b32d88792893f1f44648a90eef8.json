{"remainingRequest":"C:\\Workspace\\VueProjects\\vue-template-box\\node_modules\\babel-loader\\lib\\index.js!C:\\Workspace\\VueProjects\\vue-template-box\\src\\router\\index.js","dependencies":[{"path":"C:\\Workspace\\VueProjects\\vue-template-box\\src\\router\\index.js","mtime":1654529038000},{"path":"C:\\Workspace\\VueProjects\\vue-template-box\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1677392615027},{"path":"C:\\Workspace\\VueProjects\\vue-template-box\\node_modules\\babel-loader\\lib\\index.js","mtime":1677392616277}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.match\";\nimport _objectSpread from \"C:\\\\Workspace\\\\VueProjects\\\\vue-template-box\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/objectSpread\";\n// 引入路由模块\nimport Vue from 'vue';\nimport Router from 'vue-router';\nimport Cookies from \"js-cookie\"; // 解决ElementUI导航栏中的vue-router在3.0版本以上重复点菜单报错问题\n\nvar originalPush = Router.prototype.push;\n\nRouter.prototype.push = function push(location) {\n  return originalPush.call(this, location).catch(function (err) {\n    return err;\n  });\n}; //使用路由模块\n\n\nVue.use(Router); //引入elementui\n\nimport ElementUI from 'element-ui';\nimport 'element-ui/lib/theme-chalk/index.css'; //使用elementui\n\nVue.use(ElementUI);\nimport { menuTreeData } from \"../menu/menu\";\nimport Login from \"../Login/Login.vue\";\nimport Home from \"../menu/HomeVue\";\nimport store from '@/store';\nvar router = new Router({\n  routes: [{\n    path: '/',\n    name: 'Home',\n    component: Home,\n    children: []\n  }, {\n    path: '/Login',\n    name: 'Login',\n    component: Login\n  }]\n});\nrouter.beforeEach(function (to, from, next) {\n  // 登录界面登录成功之后，会把用户信息保存在会话\n  // 存在时间为会话生命周期，页面关闭即失效。\n  var token = Cookies.get('token');\n  var userName = sessionStorage.getItem('user');\n\n  if (to.path === '/Login') {\n    // 如果是访问登录界面，如果用户会话信息存在，代表已登录过，跳转到主页\n    if (token) {\n      next({\n        path: '/'\n      });\n    } else {\n      next();\n    }\n  } else {\n    if (!token) {\n      // 如果访问非登录界面，且户会话信息不存在，代表未登录，则跳转到登录界面\n      console.log(\"登录界面\");\n      next({\n        path: '/Login'\n      });\n    } else if (!store.state.menu.routeLoaded) {\n      // 加载动态菜单和路由\n      addDynamicMenuAndRoutes(userName); //坑：直接使用next()刷新后会一直白屏\n\n      next(_objectSpread({}, to, {\n        replace: true\n      }));\n    } else {\n      next();\n    }\n  }\n});\n\nfunction addDynamicMenuAndRoutes(userName) {\n  var dynamicRouters = addDynamicRoutes(menuTreeData); //将路由添加到Home的children中去\n\n  router.options.routes[0].children = router.options.routes[0].children.concat(dynamicRouters); //添加到路由（因版本问题，可能写成router.addRoutes,多一个s）\n\n  router.addRoute(router.options.routes[0]); // 保存加载状态\n\n  store.commit('routeLoaded', true); // 保存菜单树\n\n  store.commit('menus', menuTreeData);\n  console.log(\"路由加载\");\n}\n\nfunction addDynamicRoutes() {\n  var menuList = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var routes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  //用于筛选出最底层的children \n  var temp = [];\n\n  var _loop = function _loop(i) {\n    //判断children 是否存在\n    if (menuList[i].children && menuList[i].children.length >= 1) {\n      temp = temp.concat(menuList[i].children); //判断地址是否正确\n    } else if (menuList[i].route && /\\S/.test(menuList[i].route)) {\n      //menuList[i].route = menuList[i].route.replace(/^\\//, '');\n      // 创建路由配置\n      //踩坑记1：必须要写成@/views/${变量}\n      //踩坑记2：${变量}，这个“变量”不要用另一个变量接收，以免造成浅拷贝，使得变量的值改变\n      reg2 = /([^/]+)$/;\n      route = {\n        path: menuList[i].route,\n        name: menuList[i].menuName,\n        component: function component(resolve) {\n          return require([\"@/views/\".concat(menuList[i].route.match(reg2)[1], \".vue\")], resolve);\n        },\n        meta: {\n          icon: menuList[i].icon,\n          index: menuList[i].menuId\n        }\n      };\n      routes.push(route);\n    }\n  };\n\n  for (var i = 0; i < menuList.length; i++) {\n    var reg2;\n    var route;\n\n    _loop(i);\n  } //将筛选出来的children进行重复调用\n\n\n  if (temp.length >= 1) {\n    addDynamicRoutes(temp, routes);\n  } else {\n    console.log('动态路由加载...');\n    console.log(routes);\n    console.log('动态路由加载完成.');\n  }\n\n  return routes;\n}\n\nexport default router;",{"version":3,"sources":["C:\\Workspace\\VueProjects\\vue-template-box\\src\\router\\index.js"],"names":["Vue","Router","Cookies","originalPush","prototype","push","location","call","catch","err","use","ElementUI","menuTreeData","Login","Home","store","router","routes","path","name","component","children","beforeEach","to","from","next","token","get","userName","sessionStorage","getItem","console","log","state","menu","routeLoaded","addDynamicMenuAndRoutes","replace","dynamicRouters","addDynamicRoutes","options","concat","addRoute","commit","menuList","temp","i","length","route","test","reg2","menuName","resolve","require","match","meta","icon","index","menuId"],"mappings":"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","sourcesContent":["// 引入路由模块\nimport Vue from 'vue'\nimport Router from 'vue-router'\nimport Cookies from \"js-cookie\"\n\n// 解决ElementUI导航栏中的vue-router在3.0版本以上重复点菜单报错问题\nconst originalPush = Router.prototype.push\nRouter.prototype.push = function push(location) {\n  return originalPush.call(this, location).catch(err => err)\n}\n\n//使用路由模块\nVue.use(Router)\n\n//引入elementui\nimport ElementUI from 'element-ui'\nimport 'element-ui/lib/theme-chalk/index.css'\n//使用elementui\nVue.use(ElementUI)\n\nimport  {menuTreeData}  from '../menu/menu'\n\nimport Login from '../Login/Login.vue'\nimport Home from '../menu/HomeVue'\nimport store from '@/store'\n\n\nconst router= new Router({\n  routes: [\n    {\n      path : '/', \n      name : 'Home',\n      component :  Home,\n      children :[\n      ]\n    },\n    {\n      path : '/Login', \n      name : 'Login',\n      component :  Login\n    }\n    \n  ]\n})\n\nrouter.beforeEach((to, from, next) => {\n  // 登录界面登录成功之后，会把用户信息保存在会话\n  // 存在时间为会话生命周期，页面关闭即失效。\n  let token = Cookies.get('token')\n  let userName = sessionStorage.getItem('user')\n  if (to.path === '/Login') {\n    // 如果是访问登录界面，如果用户会话信息存在，代表已登录过，跳转到主页\n    if (token) {\n      next({\n        path: '/'\n      })\n    } else {\n      next()\n    }\n  } else {\n    if (!token) {\n      // 如果访问非登录界面，且户会话信息不存在，代表未登录，则跳转到登录界面\n      console.log(\"登录界面\")\n      next({\n        path: '/Login'\n      })\n    } else if(!store.state.menu.routeLoaded){\n      // 加载动态菜单和路由\n      addDynamicMenuAndRoutes(userName);\n      //坑：直接使用next()刷新后会一直白屏\n      next({ ...to,replace:true});\n    }\n    else{\n      next();\n    }\n  }\n})\n\nfunction addDynamicMenuAndRoutes(userName){\n  let dynamicRouters=addDynamicRoutes(menuTreeData);\n  //将路由添加到Home的children中去\n  router.options.routes[0].children=router.options.routes[0].children.concat(dynamicRouters)\n  //添加到路由（因版本问题，可能写成router.addRoutes,多一个s）\n  router.addRoute(router.options.routes[0]);\n  // 保存加载状态\n  store.commit('routeLoaded', true);\n  // 保存菜单树\n  store.commit('menus', menuTreeData);\n  console.log(\"路由加载\");\n}\n\nfunction addDynamicRoutes(menuList=[],routes=[]){\n  //用于筛选出最底层的children \n  var temp = [];\n  for (let i = 0; i < menuList.length; i++) {\n     //判断children 是否存在\n    if (menuList[i].children && menuList[i].children.length >= 1) {\n      temp = temp.concat(menuList[i].children)\n      //判断地址是否正确\n    }else if (menuList[i].route && /\\S/.test(menuList[i].route)) {\n      //menuList[i].route = menuList[i].route.replace(/^\\//, '');\n      // 创建路由配置\n      //踩坑记1：必须要写成@/views/${变量}\n      //踩坑记2：${变量}，这个“变量”不要用另一个变量接收，以免造成浅拷贝，使得变量的值改变\n      var reg2 = /([^/]+)$/;\n      var route = {\n        path: menuList[i].route,\n        name: menuList[i].menuName,\n        component: resolve => require([`@/views/${menuList[i].route.match(reg2)[1]}.vue`], resolve),\n        meta: {\n          icon: menuList[i].icon,\n          index: menuList[i].menuId\n        }\n      }\n      routes.push(route);\n    }\n  }\n  //将筛选出来的children进行重复调用\n  if (temp.length >= 1) {\n    addDynamicRoutes(temp, routes)\n  } else {\n    console.log('动态路由加载...')\n    console.log(routes)\n    console.log('动态路由加载完成.')\n  }\n  return routes\n}\n\n\nexport default router"]}]}